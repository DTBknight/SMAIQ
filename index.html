<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汽车报价计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#0FC6C2',
                        accent: '#FF7D00',
                        neutral: '#6B7280',
                        "neutral-light": '#F3F4F6',
                        "neutral-dark": '#374151'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'input': '0 2px 5px rgba(0, 0, 0, 0.05)',
                    }
                },
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .form-input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary;
            }
            .section-transition {
                @apply transition-all duration-300 ease-in-out;
            }
            .result-value {
                @apply font-semibold text-lg text-primary;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 标题区域 -->
        <div class="text-center mb-10">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-neutral-dark mb-3">汽车出口报价计算器</h1>
            <p class="text-neutral text-lg">快速计算不同类型汽车的出口报价，支持多种车型和贸易术语</p>
        </div>

        <!-- 主卡片 -->
        <div class="bg-white rounded-xl shadow-card p-6 md:p-8 mb-8">
            <!-- 表单区域 -->
            <form id="carQuoteForm" class="space-y-8">
                <!-- 报价类型 -->
                <div class="section-transition">
                    <h2 class="text-xl font-bold text-neutral-dark mb-4 flex items-center">
                        <i class="fa fa-tag text-primary mr-2"></i>报价类型
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-all duration-200">
                            <input type="radio" name="quoteType" value="EXW" class="form-radio h-5 w-5 text-primary" required>
                            <span class="ml-3">EXW</span>
                        </label>
                        <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-all duration-200">
                            <input type="radio" name="quoteType" value="FOB" class="form-radio h-5 w-5 text-primary">
                            <span class="ml-3">FOB</span>
                        </label>
                        <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-all duration-200">
                            <input type="radio" name="quoteType" value="CIF" class="form-radio h-5 w-5 text-primary">
                            <span class="ml-3">CIF</span>
                        </label>
                    </div>
                </div>

                <!-- 车型信息 -->
                <div class="section-transition">
                    <h2 class="text-xl font-bold text-neutral-dark mb-4 flex items-center">
                        <i class="fa fa-car text-primary mr-2"></i>车型信息
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="carModel" class="block text-sm font-medium text-neutral mb-2">车型名称</label>
                            <input type="text" id="carModel" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-input form-input-focus" placeholder="请输入车型名称" required>
                        </div>
                        <div>
                            <label for="carType" class="block text-sm font-medium text-neutral mb-2">车型类型</label>
                            <select id="carType" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-input form-input-focus" required>
                                <option value="">请选择车型类型</option>
                                <option value="new">新车</option>
                                <option value="used">二手车</option>
                                <option value="ev_with_tax">新能源（购置税）</option>
                                <option value="ev_without_tax">新能源（无购置税）</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 动态表单区域 -->
                <div id="dynamicFormFields" class="section-transition space-y-8">
                    <!-- 动态内容将根据车型类型插入 -->
                </div>

                <!-- 汇率信息 -->
                <div id="exchangeRateSection" class="section-transition opacity-0 pointer-events-none">
                    <h2 class="text-xl font-bold text-neutral-dark mb-4 flex items-center">
                        <i class="fa fa-money text-primary mr-2"></i>汇率信息
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="currencyType" class="block text-sm font-medium text-neutral mb-2">目标币种</label>
                            <select id="currencyType" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-input form-input-focus">
                                <option value="USD">美元 (USD)</option>
                                <option value="EUR">欧元 (EUR)</option>
                            </select>
                        </div>
                        <div>
                            <label for="exchangeRate" class="block text-sm font-medium text-neutral mb-2">汇率 <span id="baseRate" class="text-sm text-gray-500"></span></label>
                            <div class="relative">
                                <input type="number" id="exchangeRate" step="0.0001" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-input form-input-focus" placeholder="输入汇率">
                                <span class="absolute right-3 top-3 text-sm text-gray-500">波动后</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 计算按钮 -->
                <div class="pt-4">
                    <button type="button" id="calculateBtn" class="w-full md:w-auto bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fa fa-calculator mr-2"></i>计算报价
                    </button>
                </div>
                <input type="hidden" id="finalPrice">
</form>
        </div>

        <!-- 结果区域 -->
        <div id="resultSection" class="bg-white rounded-xl shadow-card p-6 md:p-8 opacity-0 pointer-events-none section-transition">
            <h2 class="text-xl font-bold text-neutral-dark mb-6 flex items-center">
                <i class="fa fa-bar-chart text-accent mr-2"></i>报价结果
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-4 bg-neutral-light rounded-lg">
                    <h3 class="font-medium text-neutral-dark mb-3">基本信息</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-neutral">车型:</span>
                            <span id="resultCarModel" class="font-medium"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">车型类型:</span>
                            <span id="resultCarType" class="font-medium"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">报价类型:</span>
                            <span id="resultQuoteType" class="font-medium"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">目标币种:</span>
                            <span id="resultCurrency" class="font-medium"></span>
                        </div>
                    </div>
                </div>
                <div class="p-4 bg-neutral-light rounded-lg">
                    <h3 class="font-medium text-neutral-dark mb-3">价格详情</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-neutral">购车成本:</span>
                            <span id="resultPurchaseCost" class="result-value"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">利润:</span>
                            <span id="resultProfit" class="result-value"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">人民币报价:</span>
                            <span id="resultCNYPrice" class="result-value"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-neutral">最终报价:</span>
                            <span id="resultFinalPrice" class="result-value text-accent text-xl"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 详细计算结果 -->
            <div class="mt-8">
                <h3 class="font-medium text-neutral-dark mb-3">详细计算</h3>
                <div id="resultDetails" class="p-4 bg-neutral-light rounded-lg space-y-2 text-sm"></div>
            </div>

            <!-- 重置按钮 -->
            <div class="mt-8 text-right">
                <button id="resetBtn" class="bg-gray-200 hover:bg-gray-300 text-neutral-dark font-medium py-2 px-6 rounded-lg transition-all duration-200">
                    <i class="fa fa-refresh mr-2"></i>重新计算
                </button>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="mt-12 text-center text-neutral text-sm">
            <p>设计与开发：DBTKnight</p>
        </footer>
    </div>

    <script>
        // 汇率数据（示例数据，实际应用中应从API获取）
        const exchangeRates = {
            USD: 7.23,  // 示例美元汇率
            EUR: 7.85   // 示例欧元汇率
        };

        // 车型类型配置
        const carTypeConfig = {
            new: {
                name: "新车",
                fields: [
                    { id: "guidePrice", name: "指导价", type: "number", required: true },
                    { id: "discount", name: "优惠", type: "number", required: true },
                    { id: "invoicePrice", name: "开票价", type: "readonly" },
                    { id: "handlingFeeRate", name: "手续费系数", type: "range", min: 0.04, max: 0.1, step: 0.01, required: true },
                    { id: "handlingFee", name: "手续费", type: "readonly" },
                    { id: "taxRefund", name: "退税", type: "readonly" },
                    { id: "domesticShipping", name: "国内运输", type: "number", required: true },
                    { id: "internationalShipping", name: "国际运输", type: "number", condition: "quoteType!='EXW'" },
                    { id: "purchaseCost", name: "购车成本", type: "readonly" },
                    { id: "profit", name: "利润", type: "number", required: true },
                    { id: "cnyPrice", name: "报价（人民币）", type: "readonly" }
                ],
                calculations: {
                    invoicePrice: "guidePrice - discount",
                    handlingFee: "invoicePrice * handlingFeeRate",
                    taxRefund: "invoicePrice / 1.13 * 0.13",
                    purchaseCost: "invoicePrice + handlingFee + domesticShipping + (quoteType!='EXW'?internationalShipping:0) - taxRefund",
                    cnyPrice: "purchaseCost + profit"
                }
            },
            used: {
                name: "二手车",
                fields: [
                    { id: "guidePrice", name: "指导价", type: "number", required: true },
                    { id: "discount", name: "优惠", type: "number", required: true },
                    { id: "invoicePrice", name: "开票价", type: "readonly" },
                    { id: "purchaseTax", name: "购置税", type: "readonly" },
                    { id: "qualificationFee", name: "资质费用", type: "number", required: true },
                    { id: "agencyFee", name: "代办费", type: "number", required: true },
                    { id: "taxRefund", name: "退税", type: "readonly" },
                    { id: "taxRefundFee", name: "退税手续费", type: "readonly" },
                    { id: "domesticShipping", name: "国内运输", type: "number", required: true },
                    { id: "internationalShipping", name: "国际运输", type: "number", condition: "quoteType!='EXW'" },
                    { id: "purchaseCost", name: "购车成本", type: "readonly" },
                    { id: "profit", name: "利润", type: "number", required: true },
                    { id: "cnyPrice", name: "报价（人民币）", type: "readonly" }
                ],
                calculations: {
                    invoicePrice: "guidePrice - discount",
                    purchaseTax: "invoicePrice / 11.3",
                    taxRefund: "invoicePrice / 1.13 * 0.13",
                    taxRefundFee: "taxRefund * 0.025",
                    purchaseCost: "invoicePrice + purchaseTax + qualificationFee + agencyFee + taxRefundFee + domesticShipping + (quoteType!='EXW'?internationalShipping:0) - taxRefund",
                    cnyPrice: "purchaseCost + profit"
                }
            },
            ev_with_tax: {
                name: "新能源（购置税）",
                fields: [
                    { id: "guidePrice", name: "指导价", type: "number", required: true },
                    { id: "discount", name: "优惠", type: "number", required: true },
                    { id: "invoicePrice", name: "开票价", type: "readonly" },
                    { id: "purchaseTax", name: "购置税", type: "readonly" },
                    { id: "qualificationFee", name: "资质费用", type: "number", required: true },
                    { id: "agencyFee", name: "代办费", type: "number", required: true },
                    { id: "taxRefund", name: "退税", type: "readonly" },
                    { id: "taxRefundFee", name: "退税手续费", type: "readonly" },
                    { id: "domesticShipping", name: "国内运输", type: "number", required: true },
                    { id: "internationalShipping", name: "国际运输", type: "number", condition: "quoteType!='EXW'" },
                    { id: "purchaseCost", name: "购车成本", type: "readonly" },
                    { id: "profit", name: "利润", type: "number", required: true },
                    { id: "cnyPrice", name: "报价（人民币）", type: "readonly" }
                ],
                calculations: {
                    invoicePrice: "guidePrice - discount",
                    purchaseTax: "invoicePrice / 11.3",
                    taxRefund: "invoicePrice / 1.13 * 0.13",
                    taxRefundFee: "taxRefund * 0.025",
                    purchaseCost: "invoicePrice + purchaseTax + qualificationFee + agencyFee + taxRefundFee + domesticShipping + (quoteType!='EXW'?internationalShipping:0) - taxRefund",
                    cnyPrice: "purchaseCost + profit"
                }
            },
            ev_without_tax: {
                name: "新能源（无购置税）",
                fields: [
                    { id: "guidePrice", name: "指导价", type: "number", required: true },
                    { id: "discount", name: "优惠", type: "number", required: true },
                    { id: "invoicePrice", name: "开票价", type: "readonly" },
                    { id: "qualificationFee", name: "资质费用", type: "number", required: true },
                    { id: "agencyFee", name: "代办费", type: "number", required: true },
                    { id: "taxRefund", name: "退税", type: "readonly" },
                    { id: "taxRefundFee", name: "退税手续费", type: "readonly" },
                    { id: "domesticShipping", name: "国内运输", type: "number", required: true },
                    { id: "internationalShipping", name: "国际运输", type: "number", condition: "quoteType!='EXW'" },
                    { id: "purchaseCost", name: "购车成本", type: "readonly" },
                    { id: "profit", name: "利润", type: "number", required: true },
                    { id: "cnyPrice", name: "报价（人民币）", type: "readonly" }
                ],
                calculations: {
                    invoicePrice: "guidePrice - discount",
                    taxRefund: "invoicePrice / 1.13 * 0.13",
                    taxRefundFee: "taxRefund * 0.025",
                    purchaseCost: "invoicePrice + qualificationFee + agencyFee + taxRefundFee + domesticShipping + (quoteType!='EXW'?internationalShipping:0) - taxRefund",
                    cnyPrice: "purchaseCost + profit"
                }
            }
        };

        // DOM 元素
        const carTypeSelect = document.getElementById('carType');
        const dynamicFormFields = document.getElementById('dynamicFormFields');
        const exchangeRateSection = document.getElementById('exchangeRateSection');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultSection = document.getElementById('resultSection');
        const resetBtn = document.getElementById('resetBtn');
        const currencyTypeSelect = document.getElementById('currencyType');
        const exchangeRateInput = document.getElementById('exchangeRate');
        const baseRateSpan = document.getElementById('baseRate');
        const quoteTypeRadios = document.querySelectorAll('input[name="quoteType"]');

        // 监听车型类型变化
        carTypeSelect.addEventListener('change', function() {
            const carType = this.value;
            if (carType) {
                renderDynamicFields(carType);
                exchangeRateSection.classList.remove('opacity-0', 'pointer-events-none');
                calculateBtn.disabled = false;
            } else {
                dynamicFormFields.innerHTML = '';
                exchangeRateSection.classList.add('opacity-0', 'pointer-events-none');
                calculateBtn.disabled = true;
            }
        });

        // 监听报价类型变化
        quoteTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                updateConditionalFields();
            });
        });

        // 监听汇率币种变化
        currencyTypeSelect.addEventListener('change', function() {
            updateExchangeRate();
        });

        // 更新汇率
        async function updateExchangeRate() {
    const currency = currencyTypeSelect.value;

    try {
        const res = await fetch(`https://openexchangerates.org/api/latest.json?app_id=145b3ca7abb2474f9e1f30b2ed19b77f`);
        const data = await res.json();

        const baseRate = data.rates[currency];
        const adjustedRate = (baseRate - 0.05).toFixed(4);

        baseRateSpan.textContent = `(实时基准: ${baseRate})`;
        exchangeRateInput.value = adjustedRate;

        calculateValues();
    } catch (error) {
        console.error("汇率获取失败", error);
        alert("汇率获取失败，请检查网络或API密钥");
    }
}

        // 渲染动态表单字段
        function renderDynamicFields(carType) {
            const config = carTypeConfig[carType];
            dynamicFormFields.innerHTML = '';
            
            // 创建价格计算部分
            const priceCalculationDiv = document.createElement('div');
            priceCalculationDiv.className = 'bg-neutral-light rounded-lg p-6';
            priceCalculationDiv.innerHTML = `
                <h2 class="text-xl font-bold text-neutral-dark mb-6 flex items-center">
                    <i class="fa fa-calculator text-primary mr-2"></i>${config.name}价格计算
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="priceFields">
                    <!-- 价格字段将动态添加 -->
                </div>
            `;
            dynamicFormFields.appendChild(priceCalculationDiv);
            
            const priceFieldsDiv = priceCalculationDiv.querySelector('#priceFields');
            
            // 添加表单字段
            config.fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'section-transition';
                fieldDiv.id = `field-${field.id}`;
                
                // 根据字段类型创建不同的输入控件
                let fieldHtml = '';
                if (field.type === 'readonly') {
                    fieldHtml = `
                        <label for="${field.id}" class="block text-sm font-medium text-neutral mb-2">${field.name}</label>
                        <div class="relative">
                            <input type="text" id="${field.id}" readonly class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-primary font-medium">
                            <span class="absolute right-3 top-3 text-sm text-gray-500">自动计算</span>
                        </div>
                    `;
                } else if (field.type === 'range') {
                    fieldHtml = `
                        <label for="${field.id}" class="block text-sm font-medium text-neutral mb-2">${field.name} <span id="${field.id}Value" class="text-primary font-medium">${field.min}</span></label>
                        <input type="range" id="${field.id}" min="${field.min}" max="${field.max}" step="${field.step}" value="${field.min}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                    `;
                } else {
                    fieldHtml = `
                        <label for="${field.id}" class="block text-sm font-medium text-neutral mb-2">${field.name}</label>
                        <input type="${field.type}" id="${field.id}" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-input form-input-focus" ${field.required ? 'required' : ''}>
                    `;
                }
                
                fieldDiv.innerHTML = fieldHtml;
                priceFieldsDiv.appendChild(fieldDiv);
                
                // 如果是输入字段，添加监听器
                if (field.type !== 'readonly') {
                    const input = document.getElementById(field.id);
                    if (field.type === 'range') {
                        const valueSpan = document.getElementById(`${field.id}Value`);
                        input.addEventListener('input', function() {
                            valueSpan.textContent = this.value;
                            calculateValues();
                        });
                    }
                    input.addEventListener('input', calculateValues);
                }
            });
            
            // 更新条件字段
            updateConditionalFields();
            
            // 初始化汇率
            updateExchangeRate();
        }

        // 更新条件字段显示
        function updateConditionalFields() {
            const carType = carTypeSelect.value;
            if (!carType) return;
            
            const config = carTypeConfig[carType];
            const quoteType = document.querySelector('input[name="quoteType"]:checked')?.value || '';
            
            config.fields.forEach(field => {
                if (field.condition) {
                    const fieldDiv = document.getElementById(`field-${field.id}`);
                    if (fieldDiv) {
                        // 评估条件表达式
                        const condition = field.condition.replace('quoteType', `'${quoteType}'`);
                        const shouldShow = eval(condition);
                        
                        if (shouldShow) {
                            fieldDiv.classList.remove('hidden');
                        } else {
                            fieldDiv.classList.add('hidden');
                            
                            // 隐藏时清除值
                            const input = document.getElementById(field.id);
                            if (input) input.value = '';
                        }
                    }
                }
            });
            
            // 重新计算值
            calculateValues();
        }

        // 计算所有值
        function calculateValues() {
            const carType = carTypeSelect.value;
            if (!carType) return;
            
            const config = carTypeConfig[carType];
            const values = {};
            
            // 收集所有输入值
            config.fields.forEach(field => {
                const input = document.getElementById(field.id);
                if (input) {
                    if (field.type === 'range' || field.type === 'number') {
                        values[field.id] = parseFloat(input.value) || 0;
                    } else {
                        values[field.id] = input.value;
                    }
                }
            });
            
            // 获取报价类型
            const quoteType = document.querySelector('input[name="quoteType"]:checked')?.value || '';
            values.quoteType = quoteType;
            
            // 执行计算
            for (const [resultField, formula] of Object.entries(config.calculations)) {
                try {
                    // 替换公式中的变量为实际值
                    let evaluatedFormula = formula;
                    // 处理条件表达式
                    evaluatedFormula = evaluatedFormula.replace(/\(([^)]+)\)\?([^:]+):([^)]+)/g, (match, condition, ifTrue, ifFalse) => {
                        const condResult = eval(condition);
                        return condResult ? ifTrue : ifFalse;
                    });
                    
                    // 计算最终结果
                    const result = eval(evaluatedFormula);
                    values[resultField] = parseFloat(result.toFixed(2));
                    
                    // 更新显示
                    const resultInput = document.getElementById(resultField);
                    if (resultInput) {
                        resultInput.value = formatCurrency(result);
                    }
                } catch (error) {
                    console.error(`计算 ${resultField} 时出错:`, error);
                }
            }
            
            // 计算最终报价
            calculateFinalPrice(values);
        }

        // 计算最终报价
        function calculateFinalPrice(values) {
            const currency = currencyTypeSelect.value;
            const rate = parseFloat(exchangeRateInput.value) || 0;
            const cnyPrice = values.cnyPrice || 0;
            
            const finalPrice = parseFloat((cnyPrice * rate).toFixed(2));
            
            // 更新显示
            document.getElementById('finalPrice').value = formatCurrency(finalPrice, currency);
        }

        // 格式化货币
        function formatCurrency(value, currency = 'CNY') {
            if (isNaN(value)) return '0.00';
            
            // 人民币格式化
            if (currency === 'CNY') {
                return `¥${value.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            // 美元格式化
            else if (currency === 'USD') {
                return `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            // 欧元格式化
            else if (currency === 'EUR') {
                return `€${value.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            
            return value.toFixed(2);
        }

        // 处理计算按钮点击
        calculateBtn.addEventListener('click', function() {
            // 验证必填字段
            const requiredFields = document.querySelectorAll('[required]:not(:disabled)');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value) {
                    isValid = false;
                    field.classList.add('border-red-500');
                    setTimeout(() => {
                        field.classList.remove('border-red-500');
                    }, 2000);
                }
            });
            
            if (!isValid) {
                alert('请填写所有必填字段');
                return;
            }
            
            // 获取车型配置
            const carType = carTypeSelect.value;
            const config = carTypeConfig[carType];
            
            // 获取所有值
            const values = {};
            config.fields.forEach(field => {
                const input = document.getElementById(field.id);
                if (input) {
                    values[field.id] = input.value;
                }
            });
            
            // 获取基本信息
            const carModel = document.getElementById('carModel').value;
            const quoteType = document.querySelector('input[name="quoteType"]:checked').value;
            const currencyType = currencyTypeSelect.value;
            
            // 更新结果区域
            document.getElementById('resultCarModel').textContent = carModel;
            document.getElementById('resultCarType').textContent = config.name;
            document.getElementById('resultQuoteType').textContent = quoteType;
            document.getElementById('resultCurrency').textContent = currencyType === 'USD' ? '美元 (USD)' : '欧元 (EUR)';
            
            // 更新价格结果
            document.getElementById('resultPurchaseCost').textContent = values.purchaseCost;
            document.getElementById('resultProfit').textContent = values.profit;
            document.getElementById('resultCNYPrice').textContent = values.cnyPrice;
            
            // 计算最终报价
            const cnyPrice = parseFloat(values.cnyPrice.replace(/[^0-9.]/g, ''));
            const rate = parseFloat(exchangeRateInput.value);
            const finalPrice = (cnyPrice * rate).toFixed(2);
            
            document.getElementById('resultFinalPrice').textContent = 
                currencyType === 'USD' ? `$${finalPrice}` : `€${finalPrice}`;
            
            // 生成详细计算过程
            generateResultDetails(values, config, currencyType, rate);
            
            // 显示结果区域
            resultSection.classList.remove('opacity-0', 'pointer-events-none');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        });

        // 生成详细计算过程
        function generateResultDetails(values, config, currencyType, rate) {
            const resultDetails = document.getElementById('resultDetails');
            resultDetails.innerHTML = '';
            
            // 添加基本计算步骤
            for (const [resultField, formula] of Object.entries(config.calculations)) {
                const fieldConfig = config.fields.find(f => f.id === resultField);
                if (!fieldConfig) continue;
                
                const fieldName = fieldConfig.name;
                const fieldValue = values[resultField];
                
                // 创建计算步骤元素
                const stepDiv = document.createElement('div');
                stepDiv.className = 'flex justify-between';
                
                // 处理条件表达式
                let displayFormula = formula.replace(/\(([^)]+)\)\?([^:]+):([^)]+)/g, (match, condition, ifTrue, ifFalse) => {
                    const condResult = eval(condition);
                    return condResult ? ifTrue : ifFalse;
                });
                
                // 替换变量为实际值
                Object.keys(values).forEach(key => {
                    const value = parseFloat(values[key].replace(/[^0-9.]/g, '')) || 0;
                    displayFormula = displayFormula.replace(new RegExp(key, 'g'), value.toFixed(2));
                });
                
                // 添加到结果
                stepDiv.innerHTML = `
                    <span class="text-neutral">${fieldName}:</span>
                    <span class="font-medium">${fieldValue} = ${displayFormula}</span>
                `;
                
                resultDetails.appendChild(stepDiv);
            }
            
            // 添加最终报价计算
            const cnyPrice = parseFloat(values.cnyPrice.replace(/[^0-9.]/g, ''));
            const finalPrice = (cnyPrice * rate).toFixed(2);
            
            const finalStepDiv = document.createElement('div');
            finalStepDiv.className = 'flex justify-between mt-2 pt-2 border-t border-gray-300';
            finalStepDiv.innerHTML = `
                <span class="text-neutral font-medium">最终报价 (${currencyType}):</span>
                <span class="font-medium text-accent">${currencyType === 'USD' ? '$' : '€'}${finalPrice} = ${cnyPrice.toFixed(2)} × ${rate.toFixed(4)}</span>
            `;
            
            resultDetails.appendChild(finalStepDiv);
        }

        // 重置按钮点击事件
        resetBtn.addEventListener('click', function() {
            document.getElementById('carQuoteForm').reset();
            dynamicFormFields.innerHTML = '';
            exchangeRateSection.classList.add('opacity-0', 'pointer-events-none');
            resultSection.classList.add('opacity-0', 'pointer-events-none');
            calculateBtn.disabled = true;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // 初始化
        calculateBtn.disabled = true;
        resultSection.classList.add('opacity-0', 'pointer-events-none');
    </script>
</body>
</html>
    
