<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>汽车报价计算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            accent: '#FF7D00',
            neutral: '#F5F7FA',
            dark: '#1D2129',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 30px -5px rgba(22, 93, 255, 0.1);
      }
      .input-focus {
        @apply focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none;
      }
      .transition-custom {
        @apply transition-all duration-300 ease-in-out;
      }
      .animate-fadeIn {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    }
  </style>
</head>

<body class="font-inter bg-gray-50 text-dark min-h-screen">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky top-0 z-50 transition-custom">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-car text-primary text-2xl"></i>
        <h1 class="text-[clamp(1.25rem,3vw,1.75rem)] font-bold text-dark">汽车报价计算器</h1>
      </div>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="container mx-auto px-4 py-8">
    <!-- 表单卡片 -->
    <div class="bg-white rounded-xl shadow-md p-6 md:p-8 mb-8">
      <form id="carQuoteForm" class="space-y-8">
        <!-- 基础信息部分 -->
        <section class="border-b border-gray-100 pb-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-info-circle text-primary mr-2"></i>基础信息
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 车型名称 -->
            <div class="space-y-2">
              <label for="carModel" class="block text-sm font-medium text-gray-700">车型名称</label>
              <input 
                type="text" 
                id="carModel" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="例如：特斯拉 Model 3"
                required
              >
            </div>
            
            <!-- 车型归属修改为车辆类型 -->
            <div class="space-y-2">
              <label for="carType" class="block text-sm font-medium text-gray-700">车辆类型</label>
              <select 
                id="carType" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                required
              >
                <option value="">请选择车辆类型</option>
                <option value="new">新车</option>
                <option value="used">二手车</option>
                <option value="newEnergyTax">新能源（购置税）</option>
                <option value="newEnergyNoTax">新能源（无购置税）</option>
              </select>
            </div>
          </div>
        </section>
        
        <!-- 新车表单 (默认隐藏，选择新车时显示) -->
        <section id="newCarForm" class="hidden space-y-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-car text-primary mr-2"></i>新车报价信息
          </h3>
          
          <!-- 报价类型 -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">报价类型</label>
            <div class="flex flex-wrap gap-3">
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="EXW" class="text-primary focus:ring-primary">
                <span class="ml-2">EXW</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="FOB" class="text-primary focus:ring-primary">
                <span class="ml-2">FOB</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="quoteType" value="CIF" class="text-primary focus:ring-primary">
                <span class="ml-2">CIF</span>
              </label>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 指导价 -->
            <div class="space-y-2">
              <label for="guidePrice" class="block text-sm font-medium text-gray-700">指导价 (元)</label>
              <input 
                type="number" 
                id="guidePrice" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入指导价"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 优惠 -->
            <div class="space-y-2">
              <label for="discount" class="block text-sm font-medium text-gray-700">优惠 (元)</label>
              <input 
                type="number" 
                id="discount" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入优惠金额"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 开票价 (自动计算) -->
            <div class="space-y-2">
              <label for="invoicePrice" class="block text-sm font-medium text-gray-700">开票价 (元)</label>
              <input 
                type="number" 
                id="invoicePrice" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 手续费 -->
            <div class="space-y-2">
              <label for="serviceFeeRate" class="block text-sm font-medium text-gray-700">手续费系数 (0.04 - 0.1)</label>
              <div class="flex flex-col">
                <input 
                  type="range" 
                  id="serviceFeeRate" 
                  min="0.04" 
                  max="0.1" 
                  step="0.01" 
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"
                >
                <div class="flex justify-between mt-1">
                  <span id="serviceFeeRateValue" class="text-sm text-gray-600">0.04</span>
                  <span id="serviceFee" class="text-sm font-medium text-primary">0.00 元</span>
                </div>
              </div>
            </div>
            
            <!-- 退税 -->
            <div class="space-y-2">
              <label for="taxRefund" class="block text-sm font-medium text-gray-700">退税 (元)</label>
              <input 
                type="number" 
                id="taxRefund" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 国内运输 -->
            <div class="space-y-2">
              <label for="domesticShipping" class="block text-sm font-medium text-gray-700">国内运输 (元)</label>
              <input 
                type="number" 
                id="domesticShipping" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入国内运输费用"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 国际运输 (条件显示) -->
            <div id="internationalShippingContainer" class="space-y-2 hidden">
              <label for="internationalShipping" class="block text-sm font-medium text-gray-700">国际运输 (元)</label>
              <input 
                type="number" 
                id="internationalShipping" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入国际运输费用"
                step="0.01"
                min="0"
              >
            </div>
          </div>
          
          <!-- 购车成本 (自动计算) -->
          <div class="space-y-2">
            <label for="purchaseCost" class="block text-sm font-medium text-gray-700">购车成本 (元)</label>
            <input 
              type="number" 
              id="purchaseCost" 
              class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
              placeholder="自动计算"
              step="0.01"
              readonly
            >
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 报价（人民币） -->
            <div class="space-y-2">
              <label for="rmbQuote" class="block text-sm font-medium text-gray-700">报价（人民币） (元)</label>
              <input 
                type="number" 
                id="rmbQuote" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 汇率 -->
            <div class="space-y-2">
              <label for="currency" class="block text-sm font-medium text-gray-700">选择币种</label>
              <select 
                id="currency" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
              >
                <option value="USD">美元 (USD)</option>
                <option value="EUR">欧元 (EUR)</option>
                <option value="GBP">英镑 (GBP)</option>
              </select>
            </div>
            
            <!-- 汇率显示，修改标题 -->
            <div class="space-y-2">
              <label id="exchangeRateLabel" for="exchangeRate" class="block text-sm font-medium text-gray-700">实时基准汇率：加载中...</label>
              <input 
                type="number" 
                id="exchangeRate" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="加载中..."
                step="0.0001"
              >
            </div>
            
            <!-- 最终报价 -->
            <div class="space-y-2 md:col-span-2">
              <label for="finalQuote" class="block text-sm font-medium text-gray-700">最终报价</label>
              <input 
                type="number" 
                id="finalQuote" 
                class="w-full px-4 py-3 border-2 border-primary bg-primary/5 rounded-lg text-lg font-medium input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
          </div>
        </section>
        
        <!-- 二手车表单 (默认隐藏) -->
        <section id="usedCarForm" class="hidden space-y-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="fa fa-car text-primary mr-2"></i>二手车报价信息
          </h3>
          
          <!-- 报价类型 -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">报价类型</label>
            <div class="flex flex-wrap gap-3">
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="EXW" class="text-primary focus:ring-primary">
                <span class="ml-2">EXW</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="FOB" class="text-primary focus:ring-primary">
                <span class="ml-2">FOB</span>
              </label>
              <label class="inline-flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-custom">
                <input type="radio" name="usedQuoteType" value="CIF" class="text-primary focus:ring-primary">
                <span class="ml-2">CIF</span>
              </label>
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 指导价 -->
            <div class="space-y-2">
              <label for="usedGuidePrice" class="block text-sm font-medium text-gray-700">指导价 (元)</label>
              <input 
                type="number" 
                id="usedGuidePrice" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入指导价"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 优惠 -->
            <div class="space-y-2">
              <label for="usedDiscount" class="block text-sm font-medium text-gray-700">优惠 (元)</label>
              <input 
                type="number" 
                id="usedDiscount" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入优惠金额"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 开票价 (自动计算) -->
            <div class="space-y-2">
              <label for="usedInvoicePrice" class="block text-sm font-medium text-gray-700">开票价 (元)</label>
              <input 
                type="number" 
                id="usedInvoicePrice" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 购置税 (自动计算) -->
            <div class="space-y-2">
              <label for="usedPurchaseTax" class="block text-sm font-medium text-gray-700">购置税 (元)</label>
              <input 
                type="number" 
                id="usedPurchaseTax" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 资质费用 -->
            <div class="space-y-2">
              <label for="usedQualificationFee" class="block text-sm font-medium text-gray-700">资质费用 (元)</label>
              <input 
                type="number" 
                id="usedQualificationFee" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入资质费用"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 代办费 -->
            <div class="space-y-2">
              <label for="usedAgencyFee" class="block text-sm font-medium text-gray-700">代办费 (元)</label>
              <input 
                type="number" 
                id="usedAgencyFee" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入代办费用"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 退税 (自动计算) -->
            <div class="space-y-2">
              <label for="usedTaxRefund" class="block text-sm font-medium text-gray-700">退税 (元)</label>
              <input 
                type="number" 
                id="usedTaxRefund" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 退税手续费 (自动计算) -->
            <div class="space-y-2">
              <label for="usedTaxRefundFee" class="block text-sm font-medium text-gray-700">退税手续费 (元)</label>
              <input 
                type="number" 
                id="usedTaxRefundFee" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
            
            <!-- 国内运输 -->
            <div class="space-y-2">
              <label for="usedDomesticShipping" class="block text-sm font-medium text-gray-700">国内运输 (元)</label>
              <input 
                type="number" 
                id="usedDomesticShipping" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入国内运输费用"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 国际运输 (条件显示) -->
            <div id="usedInternationalShippingContainer" class="space-y-2 hidden">
              <label for="usedInternationalShipping" class="block text-sm font-medium text-gray-700">国际运输 (元)</label>
              <input 
                type="number" 
                id="usedInternationalShipping" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入国际运输费用"
                step="0.01"
                min="0"
              >
            </div>
          </div>
          
          <!-- 购车成本 (自动计算) -->
          <div class="space-y-2">
            <label for="usedPurchaseCost" class="block text-sm font-medium text-gray-700">购车成本 (元)</label>
            <input 
              type="number" 
              id="usedPurchaseCost" 
              class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
              placeholder="自动计算"
              step="0.01"
              readonly
            >
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 利润 -->
            <div class="space-y-2">
              <label for="usedProfit" class="block text-sm font-medium text-gray-700">利润 (元)</label>
              <input 
                type="number" 
                id="usedProfit" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus transition-custom"
                placeholder="输入期望利润"
                step="0.01"
                min="0"
              >
            </div>
            
            <!-- 报价（人民币） -->
            <div class="space-y-2">
              <label for="usedRmbQuote" class="block text-sm font-medium text-gray-700">报价（人民币） (元)</label>
              <input 
                type="number" 
                id="usedRmbQuote" 
                class="w-full px-4 py-2 border border-gray-300 bg-gray-50 rounded-lg input-focus transition-custom"
                placeholder="自动计算"
                step="0.01"
                readonly
              >
            </div>
          </div>
        </section>
        
        <!-- 新能源（购置税）表单 (默认隐藏) -->
        <section id="newEnergyTaxForm" class="hidden">
          <h3 class="text-xl font-semibold mb-4">新能源（购置税）报价信息</h3>
          <div class="p-6 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-gray-500 text-center">新能源（购置税）表单功能正在开发中...</p>
          </div>
        </section>
        
        <!-- 新能源（无购置税）表单 (默认隐藏) -->
        <section id="newEnergyNoTaxForm" class="hidden">
          <h3 class="text-xl font-semibold mb-4">新能源（无购置税）报价信息</h3>
          <div class="p-6 bg-gray-50 rounded-lg border border-gray-200">
            <p class="text-gray-500 text-center">新能源（无购置税）表单功能正在开发中...</p>
          </div>
        </section>
        
        <!-- 提交按钮 -->
        <div class="flex justify-center pt-4">
          <button 
            type="button" 
            id="calculateBtn"
            class="px-8 py-3 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg shadow-md hover:shadow-lg transition-custom flex items-center"
          >
            <i class="fa fa-calculator mr-2"></i>计算报价
          </button>
        </div>
      </form>
    </div>
    
    <!-- 报价结果卡片 -->
    <div id="resultCard" class="hidden bg-white rounded-xl shadow-md p-6 md:p-8 mb-8 transform transition-custom hover:shadow-lg">
      <h3 class="text-xl font-semibold mb-6 flex items-center">
        <i class="fa fa-file-text-o text-primary mr-2"></i>报价结果
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="border-b border-gray-100 pb-4 md:border-b-0 md:border-r border-gray-100 md:pr-6">
          <h4 class="text-lg font-medium text-gray-700 mb-4">基础信息</h4>
          <ul class="space-y-3">
            <li class="flex justify-between">
              <span class="text-gray-600">车型名称:</span>
              <span id="resultCarModel" class="font-medium"></span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">车型类型:</span>
              <span id="resultCarType" class="font-medium"></span>
            </li>
            <li class="flex justify-between">
              <span class="text-gray-600">报价类型:</span>
              <span id="resultQuoteType" class="font-medium"></span>
            </li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-medium text-gray-700 mb-4">成本明细</h4>
          <ul class="space-y-3" id="resultCostDetails">
            <!-- 动态填充 -->
          </ul>
        </div>
      </div>
      
      <div class="mt-6 pt-6 border-t border-gray-100">
        <h4 class="text-lg font-medium text-gray-700 mb-4">报价汇总</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-500 mb-1">利润</div>
            <div id="resultProfit" class="text-lg font-semibold"></div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg text-center">
            <div class="text-sm text-gray-500 mb-1">人民币报价</div>
            <div id="resultRmbQuote" class="text-lg font-semibold"></div>
          </div>
          <div class="bg-primary/10 p-4 rounded-lg text-center border border-primary/20">
            <div class="text-sm text-gray-500 mb-1" id="resultCurrencyText">最终报价 (USD)</div>
            <div id="resultFinalQuote" class="text-lg font-semibold text-primary"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-white py-8">
    <div class="container mx-auto px-4">
      <div class="text-center text-gray-500 text-sm">
        Designed by DTBKnight
      </div>
    </div>
  </footer>

  <script>
    // 格式化数字为货币格式
    function formatCurrency(value, currency = 'CNY') {
      if (isNaN(value) || value === '' || value === null) return '0.00';
      
      const options = {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      };
      
      if (currency === 'CNY') {
        options.style = 'currency';
        options.currency = 'CNY';
      } else if (currency === 'USD') {
        options.style = 'currency';
        options.currency = 'USD';
      } else if (currency === 'EUR') {
        options.style = 'currency';
        options.currency = 'EUR';
      } else if (currency === 'GBP') {
        options.style = 'currency';
        options.currency = 'GBP';
      }
      
      return new Intl.NumberFormat('zh-CN', options).format(value);
    }
    
    // 处理车型类型切换
    document.getElementById('carType').addEventListener('change', function() {
      const carType = this.value;
      
      // 隐藏所有表单
      document.getElementById('newCarForm').classList.add('hidden');
      document.getElementById('usedCarForm').classList.add('hidden');
      document.getElementById('newEnergyTaxForm').classList.add('hidden');
      document.getElementById('newEnergyNoTaxForm').classList.add('hidden');
      
      // 显示选中的表单
      if (carType === 'new') {
        document.getElementById('newCarForm').classList.remove('hidden');
        document.getElementById('newCarForm').classList.add('animate-fadeIn');
      } else if (carType === 'used') {
        document.getElementById('usedCarForm').classList.remove('hidden');
        document.getElementById('usedCarForm').classList.add('animate-fadeIn');
      } else if (carType === 'newEnergyTax') {
        document.getElementById('newEnergyTaxForm').classList.remove('hidden');
      } else if (carType === 'newEnergyNoTax') {
        document.getElementById('newEnergyNoTaxForm').classList.remove('hidden');
      }
    });
    
    // 处理新车报价类型切换（显示/隐藏国际运输）
    document.querySelectorAll('input[name="quoteType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const container = document.getElementById('internationalShippingContainer');
        if (this.value === 'EXW') {
          container.classList.add('hidden');
          document.getElementById('internationalShipping').value = '';
        } else {
          container.classList.remove('hidden');
          container.classList.add('animate-fadeIn');
        }
        calculateNewCarAll();
      });
    });
    
    // 处理二手车报价类型切换（显示/隐藏国际运输）
    document.querySelectorAll('input[name="usedQuoteType"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const container = document.getElementById('usedInternationalShippingContainer');
        if (this.value === 'EXW') {
          container.classList.add('hidden');
          document.getElementById('usedInternationalShipping').value = '';
        } else {
          container.classList.remove('hidden');
          container.classList.add('animate-fadeIn');
        }
        calculateUsedCarAll();
      });
    });
    
    // 新车表单 - 手续费系数滑块
    const serviceFeeRate = document.getElementById('serviceFeeRate');
    const serviceFeeRateValue = document.getElementById('serviceFeeRateValue');
    const serviceFee = document.getElementById('serviceFee');
    
    serviceFeeRate.addEventListener('input', function() {
      const value = parseFloat(this.value).toFixed(2);
      serviceFeeRateValue.textContent = value;
      calculateNewCarServiceFee();
      calculateNewCarPurchaseCost();
      calculateNewCarRmbQuote();
      calculateFinalQuote();
    });
    
    // 新车计算 - 手续费
    function calculateNewCarServiceFee() {
      const rate = parseFloat(document.getElementById('serviceFeeRate').value);
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const fee = rate * invoicePrice;
      serviceFee.textContent = formatCurrency(fee);
      return fee;
    }
    
    // 新车计算 - 开票价
    function calculateNewCarInvoicePrice() {
      const guidePrice = parseFloat(document.getElementById('guidePrice').value) || 0;
      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const invoicePrice = Math.max(0, guidePrice - discount);
      document.getElementById('invoicePrice').value = invoicePrice.toFixed(2);
      return invoicePrice;
    }
    
    // 新车计算 - 退税
    function calculateNewCarTaxRefund() {
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const taxRefund = invoicePrice / 1.13 * 0.13;
      document.getElementById('taxRefund').value = taxRefund.toFixed(2);
      return taxRefund;
    }
    
    // 新车计算 - 购车成本
    function calculateNewCarPurchaseCost() {
      const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
      const serviceFee = calculateNewCarServiceFee();
      const domesticShipping = parseFloat(document.getElementById('domesticShipping').value) || 0;
      const internationalShipping = parseFloat(document.getElementById('internationalShipping').value) || 0;
      const taxRefund = parseFloat(document.getElementById('taxRefund').value) || 0;
      
      const purchaseCost = invoicePrice + serviceFee + domesticShipping + internationalShipping - taxRefund;
      document.getElementById('purchaseCost').value = purchaseCost.toFixed(2);
      return purchaseCost;
    }
    
    // 新车计算 - 人民币报价
    function calculateNewCarRmbQuote() {
      const purchaseCost = parseFloat(document.getElementById('purchaseCost').value) || 0;
      const profit = 0; // 新车表单去除利润一项
      const rmbQuote = purchaseCost + profit;
      document.getElementById('rmbQuote').value = rmbQuote.toFixed(2);
      return rmbQuote;
    }
    
    // 二手车计算 - 开票价
    function calculateUsedCarInvoicePrice() {
      const guidePrice = parseFloat(document.getElementById('usedGuidePrice').value) || 0;
      const discount = parseFloat(document.getElementById('usedDiscount').value) || 0;
      const invoicePrice = Math.max(0, guidePrice - discount);
      document.getElementById('usedInvoicePrice').value = invoicePrice.toFixed(2);
      return invoicePrice;
    }
    
    // 二手车计算 - 购置税
    function calculateUsedCarPurchaseTax() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const purchaseTax = invoicePrice / 11.3;
      document.getElementById('usedPurchaseTax').value = purchaseTax.toFixed(2);
      return purchaseTax;
    }
    
    // 二手车计算 - 退税
    function calculateUsedCarTaxRefund() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const taxRefund = invoicePrice / 1.13 * 0.13;
      document.getElementById('usedTaxRefund').value = taxRefund.toFixed(2);
      return taxRefund;
    }
    
    // 二手车计算 - 退税手续费
    function calculateUsedCarTaxRefundFee() {
      const taxRefund = parseFloat(document.getElementById('usedTaxRefund').value) || 0;
      const taxRefundFee = taxRefund * 0.025;
      document.getElementById('usedTaxRefundFee').value = taxRefundFee.toFixed(2);
      return taxRefundFee;
    }
    
    // 二手车计算 - 购车成本
    function calculateUsedCarPurchaseCost() {
      const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
      const purchaseTax = calculateUsedCarPurchaseTax();
      const qualificationFee = parseFloat(document.getElementById('usedQualificationFee').value) || 0;
      const agencyFee = parseFloat(document.getElementById('usedAgencyFee').value) || 0;
      const taxRefund = parseFloat(document.getElementById('usedTaxRefund').value) || 0;
      const taxRefundFee = calculateUsedCarTaxRefundFee();
      const domesticShipping = parseFloat(document.getElementById('usedDomesticShipping').value) || 0;
      const internationalShipping = parseFloat(document.getElementById('usedInternationalShipping').value) || 0;
      
      const purchaseCost = invoicePrice + purchaseTax + qualificationFee + agencyFee + taxRefundFee + domesticShipping + internationalShipping - taxRefund;
      document.getElementById('usedPurchaseCost').value = purchaseCost.toFixed(2);
      return purchaseCost;
    }
    
    // 二手车计算 - 人民币报价
    function calculateUsedCarRmbQuote() {
      const purchaseCost = parseFloat(document.getElementById('usedPurchaseCost').value) || 0;
      const profit = parseFloat(document.getElementById('usedProfit').value) || 0;
      const rmbQuote = purchaseCost + profit;
      document.getElementById('usedRmbQuote').value = rmbQuote.toFixed(2);
      return rmbQuote;
    }
    
    // 计算最终报价
    function calculateFinalQuote() {
      const carType = document.getElementById('carType').value;
      let rmbQuote = 0;
      
      if (carType === 'new') {
        rmbQuote = parseFloat(document.getElementById('rmbQuote').value) || 0;
      } else if (carType === 'used') {
        rmbQuote = parseFloat(document.getElementById('usedRmbQuote').value) || 0;
      }
      
      const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
      const currency = document.getElementById('currency').value;
      
      if (currency && exchangeRate > 0 && rmbQuote > 0) {
        const finalQuote = rmbQuote / exchangeRate;
        document.getElementById('finalQuote').value = finalQuote.toFixed(2);
        return finalQuote;
      }
      return 0;
    }
    
    // 新车计算 - 所有计算
    function calculateNewCarAll() {
      calculateNewCarInvoicePrice();
      calculateNewCarTaxRefund();
      calculateNewCarServiceFee();
      calculateNewCarPurchaseCost();
      calculateNewCarRmbQuote();
      calculateFinalQuote();
    }
    
    // 二手车计算 - 所有计算
    function calculateUsedCarAll() {
      calculateUsedCarInvoicePrice();
      calculateUsedCarPurchaseTax();
      calculateUsedCarTaxRefund();
      calculateUsedCarTaxRefundFee();
      calculateUsedCarPurchaseCost();
      calculateUsedCarRmbQuote();
      calculateFinalQuote();
    }
    
    // 绑定新车表单输入事件
    document.getElementById('guidePrice').addEventListener('input', calculateNewCarAll);
    document.getElementById('discount').addEventListener('input', calculateNewCarAll);
    document.getElementById('domesticShipping').addEventListener('input', calculateNewCarAll);
    document.getElementById('internationalShipping').addEventListener('input', calculateNewCarAll);
    
    // 绑定二手车表单输入事件
    document.getElementById('usedGuidePrice').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedDiscount').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedQualificationFee').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedAgencyFee').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedDomesticShipping').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedInternationalShipping').addEventListener('input', calculateUsedCarAll);
    document.getElementById('usedProfit').addEventListener('input', calculateUsedCarAll);

    // 显示结果卡片
    document.getElementById('calculateBtn').addEventListener('click', function() {
      const resultCard = document.getElementById('resultCard');
      
      // 显示结果卡片
      resultCard.classList.remove('hidden');
      resultCard.classList.add('animate-fadeIn');
      
      // 填充结果信息
      const carType = document.getElementById('carType').value;
      const carTypeName = {
        'new': '新车',
        'used': '二手车',
        'newEnergyTax': '新能源（购置税）',
        'newEnergyNoTax': '新能源（无购置税）'
      }[carType] || '未知';
      
      document.getElementById('resultCarModel').textContent = document.getElementById('carModel').value || '未填写';
      document.getElementById('resultCarType').textContent = carTypeName;
      
      // 处理报价类型
      let quoteType = '';
      if (carType === 'new') {
        quoteType = document.querySelector('input[name="quoteType"]:checked')?.value || '';
      } else if (carType === 'used') {
        quoteType = document.querySelector('input[name="usedQuoteType"]:checked')?.value || '';
      }
      
      const quoteTypeName = {
        'EXW': '工厂交货',
        'FOB': '船上交货',
        'CIF': '成本加保险费加运费'
      }[quoteType] || '未选择';
      
      document.getElementById('resultQuoteType').textContent = quoteTypeName;
      
      // 填充成本明细
      const costDetails = document.getElementById('resultCostDetails');
      costDetails.innerHTML = '';
      
      if (carType === 'new') {
        // 新车成本明细
        const guidePrice = parseFloat(document.getElementById('guidePrice').value) || 0;
        const discount = parseFloat(document.getElementById('discount').value) || 0;
        const invoicePrice = parseFloat(document.getElementById('invoicePrice').value) || 0;
        const serviceFee = parseFloat(document.getElementById('serviceFeeRate').value) * invoicePrice;
        const taxRefund = parseFloat(document.getElementById('taxRefund').value) || 0;
        const domesticShipping = parseFloat(document.getElementById('domesticShipping').value) || 0;
        const internationalShipping = parseFloat(document.getElementById('internationalShipping').value) || 0;
        const purchaseCost = parseFloat(document.getElementById('purchaseCost').value) || 0;
        
        addCostDetail('指导价', guidePrice);
        addCostDetail('优惠', discount, true);
        addCostDetail('开票价', invoicePrice);
        addCostDetail('手续费', serviceFee);
        addCostDetail('退税', taxRefund, true);
        addCostDetail('国内运输', domesticShipping);
        
        if (quoteType !== 'EXW') {
          addCostDetail('国际运输', internationalShipping);
        }
        
        addCostDetail('购车成本', purchaseCost, false, 'text-primary font-medium');
        
      } else if (carType === 'used') {
        // 二手车成本明细
        const guidePrice = parseFloat(document.getElementById('usedGuidePrice').value) || 0;
        const discount = parseFloat(document.getElementById('usedDiscount').value) || 0;
        const invoicePrice = parseFloat(document.getElementById('usedInvoicePrice').value) || 0;
        const purchaseTax = parseFloat(document.getElementById('usedPurchaseTax').value) || 0;
        const qualificationFee = parseFloat(document.getElementById('usedQualificationFee').value) || 0;
        const agencyFee = parseFloat(document.getElementById('usedAgencyFee').value) || 0;
        const taxRefund = parseFloat(document.getElementById('usedTaxRefund').value) || 0;
        const taxRefundFee = parseFloat(document.getElementById('usedTaxRefundFee').value) || 0;
        const domesticShipping = parseFloat(document.getElementById('usedDomesticShipping').value) || 0;
        const internationalShipping = parseFloat(document.getElementById('usedInternationalShipping').value) || 0;
        const purchaseCost = parseFloat(document.getElementById('usedPurchaseCost').value) || 0;
        const profit = parseFloat(document.getElementById('usedProfit').value) || 0;
        const rmbQuote = parseFloat(document.getElementById('usedRmbQuote').value) || 0;
        
        addCostDetail('指导价', guidePrice);
        addCostDetail('优惠', discount, true);
        addCostDetail('开票价', invoicePrice);
        addCostDetail('购置税', purchaseTax);
        addCostDetail('资质费用', qualificationFee);
        addCostDetail('代办费', agencyFee);
        addCostDetail('退税', taxRefund, true);
        addCostDetail('退税手续费', taxRefundFee);
        addCostDetail('国内运输', domesticShipping);
        
        if (quoteType !== 'EXW') {
          addCostDetail('国际运输', internationalShipping);
        }
        
        addCostDetail('购车成本', purchaseCost);
        addCostDetail('利润', profit);
        addCostDetail('人民币报价', rmbQuote, false, 'text-primary font-medium');
      }
      
      // 填充汇总信息
      const profitValue = carType === 'used' ? parseFloat(document.getElementById('usedProfit').value) || 0 : 0;
      const rmbQuoteValue = carType === 'new' ? parseFloat(document.getElementById('rmbQuote').value) || 0 : parseFloat(document.getElementById('usedRmbQuote').value) || 0;
      const finalQuoteValue = parseFloat(document.getElementById('finalQuote').value) || 0;
      const currency = document.getElementById('currency').value;
      
      document.getElementById('resultProfit').textContent = formatCurrency(profitValue);
      document.getElementById('resultRmbQuote').textContent = formatCurrency(rmbQuoteValue);
      document.getElementById('resultFinalQuote').textContent = formatCurrency(finalQuoteValue, currency);
      
      // 更新货币文本
      const currencyNames = {
        'USD': '美元 (USD)',
        'EUR': '欧元 (EUR)',
        'GBP': '英镑 (GBP)'
      };
      
      document.getElementById('resultCurrencyText').textContent = `最终报价 (${currencyNames[currency] || 'USD'})`;
    });
    
    // 添加成本明细项
    function addCostDetail(label, value, isNegative = false, extraClass = '') {
      const costDetails = document.getElementById('resultCostDetails');
      const li = document.createElement('li');
      li.className = 'flex justify-between ' + extraClass;
      
      const valueText = isNegative ? `- ${formatCurrency(value)}` : formatCurrency(value);
      
      li.innerHTML = `
        <span class="text-gray-600">${label}:</span>
        <span>${valueText}</span>
      `;
      
      costDetails.appendChild(li);
    }

    // 获取汇率信息
    function getExchangeRates() {
      const exchangeRateLabel = document.getElementById('exchangeRateLabel');
      const exchangeRateInput = document.getElementById('exchangeRate');
      const currencySelect = document.getElementById('currency');
      
      // 显示加载状态
      exchangeRateLabel.textContent = '实时基准汇率：加载中...';
      exchangeRateInput.value = '加载中...';
      
      // 使用代理解决CORS问题
      const proxyUrl = 'https://api.allorigins.win/raw?url=';
      const apiUrl = 'https://api.fixer.io/latest?base=CNY&symbols=USD,EUR,GBP';
      
      fetch(proxyUrl + encodeURIComponent(apiUrl))
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP错误，状态码：${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (!data || !data.rates) {
            throw new Error('无效的API响应');
          }
          
          // 存储汇率数据
          window.exchangeRates = data.rates;
          
          // 默认显示美元汇率
          const baseRate = 1 / window.exchangeRates.USD;
          updateExchangeRateLabel('USD', baseRate);
          
          // 设置实际使用的汇率（扣除差价）
          exchangeRateInput.value = (baseRate - 0.05).toFixed(4);
          
          // 计算初始报价
          calculateFinalQuote();

          // 监听币种选择变化
          currencySelect.addEventListener('change', function() {
            const selectedCurrency = this.value;
            
            // 计算所选币种对人民币的汇率
            const baseRate = 1 / window.exchangeRates[selectedCurrency];
            updateExchangeRateLabel(selectedCurrency, baseRate);
            
            // 设置实际使用的汇率（扣除差价）
            exchangeRateInput.value = (baseRate - 0.05).toFixed(4);
            
            // 重新计算报价
            calculateFinalQuote();
          });
        })
        .catch(error => {
          console.error('获取汇率信息失败:', error);
          exchangeRateLabel.textContent = '实时基准汇率：获取失败';
          exchangeRateInput.value = '0';
          
          // 使用默认汇率
          const defaultRates = {
            USD: 7.2,
            EUR: 7.8,
            GBP: 9.0
          };
          window.exchangeRates = defaultRates;
          
          // 设置默认汇率
          const baseRate = 1 / defaultRates.USD;
          updateExchangeRateLabel('USD', baseRate);
          exchangeRateInput.value = (baseRate - 0.05).toFixed(4);
        });
    }

    // 更新汇率标签显示
    function updateExchangeRateLabel(currency, baseRate) {
      const exchangeRateLabel = document.getElementById('exchangeRateLabel');
      const currencyNames = {
        'USD': '美元',
        'EUR': '欧元',
        'GBP': '英镑'
      };
      
      const currencyName = currencyNames[currency] || currency;
      const formattedRate = baseRate.toFixed(4);
      
      exchangeRateLabel.textContent = `实时基准汇率：1 ${currencyName} = ${formattedRate} CNY`;
    }
    
    // 页面加载时获取汇率信息
    window.addEventListener('load', getExchangeRates);
    
    // 监听汇率输入框变化
    document.getElementById('exchangeRate').addEventListener('input', function() {
      calculateFinalQuote();
    });
  </script>
</body>
</html>
